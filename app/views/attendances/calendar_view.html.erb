<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" rel="stylesheet"/>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
  
  <title>Calendar View</title>
</head>
<body>
  <label for="employeeCode">Select Employee Code:</label>
  <select id="employeeCode" onchange="updateCalendar()">
    <% @users.each do |user| %>
      <option value="<%= user.employee_code %>" <%= 'selected' if user.employee_code == @employee_code %>><%= user.employee_code %></option>
    <% end %>
  </select>

  <label for="selectedMonth">Select Month:</label>
  <select id="selectedMonth" onchange="updateCalendar()">
    <% (1..12).each do |month| %>
      <option value="<%= month %>" <%= 'selected' if month.to_s == @selected_month.to_s %>><%= Date::MONTHNAMES[month] %></option>
    <% end %>
  </select>

  <div id="calendar"></div>

 <script>
  function updateCalendar() {
  var selectedEmployeeCode = $('#employeeCode').val();
  var selectedMonth = $('#selectedMonth').val();

  $.ajax({
    url: '/attendances/calendar_view',
    method: 'GET',
    data: { employee_code: selectedEmployeeCode, selected_month: selectedMonth },
    dataType: 'json',
    success: function(data) {
      var attendanceData = Array.isArray(data.attendances) ? data.attendances : [];
      var holidayData = Array.isArray(data.holidays) ? data.holidays : [];
      var events = getCalendarEvents(attendanceData, holidayData);

      $('#calendar').fullCalendar('destroy');

      $('#calendar').fullCalendar({
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,basicWeek,basicDay'
        },
        events: events,
        dayClick: function(date) {
          console.log('Holiday Data:', holidayData);
          alert('Clicked on: ' + date.format());
        }
      });
    },
    error: function(error) {
      console.error('Error fetching calendar data:', error);
    }
  });
}

$(document).ready(function() {
  $('#calendar').fullCalendar({
    header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month,basicWeek,basicDay'
    },
    events: [],
    dayClick: function(date) {
      console.log('Holiday Data:', holidayData);
      alert('Clicked on: ' + date.format());
    }
  });
});

</script>

</body>
</html>
